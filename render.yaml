version: "1"
services:
  - type: web
    name: pli2050-backend
    # Usar runtime Python para rodar FastAPI + Uvicorn
    runtime: python
    region: oregon
    plan: free
    branch: main
    buildCommand: >-
      # Instalar dependências Python e copiar pasta frontend para dentro do backend
      if [ -f backend-fastapi/requirements.txt ]; then
        python -m pip install --upgrade pip && python -m pip install -r backend-fastapi/requirements.txt;
      fi
      # Garantir que o diretório frontend esteja disponível para o backend
      if [ -d frontend ]; then
        rm -rf backend-fastapi/frontend || true; mkdir -p backend-fastapi; cp -R frontend backend-fastapi/frontend || true;
      fi
    startCommand: >-
      # Start Uvicorn apontando para backend-fastapi.main
      uvicorn backend-fastapi.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PGHOST
        value: sigma-pli-postgresql-db.cwlmgwc4igdh.us-east-1.rds.amazonaws.com
      - key: PGPORT
        value: 5432
      - key: PGDATABASE
        value: sigma_pli
      - key: PGUSER
        value: sigma_admin
      - key: PGPASSWORD
        value: Malditas131533*
      - key: SCHEMA_NAME
        value: formulario_embarcadores
      - key: ALLOWED_ORIGINS
        value: https://vpcapanema.github.io,http://localhost:5500,http://127.0.0.1:5500
      - key: APP_ENV
        value: production
      - key: DEBUG
        value: "false"
      - key: LOG_LEVEL
        value: info
