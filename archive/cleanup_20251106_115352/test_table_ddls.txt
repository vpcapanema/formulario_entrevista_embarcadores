-- DDL for table formulario_embarcadores.empresas
CREATE TABLE formulario_embarcadores.empresas (
id_empresa integer(32) DEFAULT nextval('formulario_embarcadores.empresas_id_empresa_seq'::regclass) NOT NULL,
nome_empresa character varying(255) NOT NULL,
tipo_empresa character varying(50) NOT NULL,
outro_tipo character varying(255),
municipio character varying(255) NOT NULL,
estado character varying(100),
cnpj character varying(18),
data_cadastro timestamp with time zone DEFAULT now(),
data_atualizacao timestamp with time zone,
razao_social character varying(255),
nome_fantasia character varying(255),
telefone character varying(20),
email character varying(255),
id_municipio integer(32),
logradouro character varying(255),
numero character varying(20),
complemento character varying(100),
bairro character varying(100),
cep character varying(8)
,
  PRIMARY KEY (id_empresa)
);

-- Constraints:
-- name: check_tipo_empresa
ALTER TABLE formulario_embarcadores.empresas ADD CONSTRAINT check_tipo_empresa CHECK (((tipo_empresa)::text = ANY ((ARRAY['embarcador'::character varying, 'transportador'::character varying, 'operador'::character varying, 'outro'::character varying])::text[])));
-- name: empresas_cnpj_key
ALTER TABLE formulario_embarcadores.empresas ADD CONSTRAINT empresas_cnpj_key UNIQUE (cnpj);


-- DDL for table formulario_embarcadores.entrevistados
CREATE TABLE formulario_embarcadores.entrevistados (
id_entrevistado integer(32) DEFAULT nextval('formulario_embarcadores.entrevistados_id_entrevistado_seq'::regclass) NOT NULL,
id_empresa integer(32) NOT NULL,
nome character varying(255) NOT NULL,
funcao character varying(255) NOT NULL,
telefone character varying(20) NOT NULL,
email character varying(255) NOT NULL,
principal boolean DEFAULT false,
data_cadastro timestamp with time zone DEFAULT now(),
data_atualizacao timestamp with time zone
,
  PRIMARY KEY (id_entrevistado)
);

-- Constraints:
-- name: email_entrevistado_valido
ALTER TABLE formulario_embarcadores.entrevistados ADD CONSTRAINT email_entrevistado_valido CHECK (((email)::text ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'::text));
-- name: entrevistados_id_empresa_fkey
ALTER TABLE formulario_embarcadores.entrevistados ADD CONSTRAINT entrevistados_id_empresa_fkey FOREIGN KEY (id_empresa) REFERENCES formulario_embarcadores.empresas(id_empresa) ON DELETE CASCADE;


-- DDL for table formulario_embarcadores.pesquisas
CREATE TABLE formulario_embarcadores.pesquisas (
id_pesquisa integer(32) DEFAULT nextval('formulario_embarcadores.pesquisas_id_pesquisa_seq'::regclass) NOT NULL,
id_empresa integer(32) NOT NULL,
id_entrevistado integer(32) NOT NULL,
tipo_responsavel character varying(20) NOT NULL,
id_responsavel integer(32) NOT NULL,
data_entrevista timestamp with time zone DEFAULT now(),
data_atualizacao timestamp with time zone,
status character varying(20) DEFAULT 'finalizada'::character varying,
produto_principal character varying(255) NOT NULL,
agrupamento_produto character varying(100) NOT NULL,
outro_produto character varying(255),
tipo_transporte character varying(50) NOT NULL,
origem_pais character varying(100) NOT NULL,
origem_estado character varying(100) NOT NULL,
origem_municipio character varying(255) NOT NULL,
destino_pais character varying(100) NOT NULL,
destino_estado character varying(100) NOT NULL,
destino_municipio character varying(255) NOT NULL,
distancia numeric(10,2) NOT NULL,
tem_paradas character varying(3) NOT NULL,
modos ARRAY NOT NULL,
config_veiculo character varying(100),
peso_carga numeric(12,2) NOT NULL,
unidade_peso character varying(20) NOT NULL,
custo_transporte numeric(12,2) NOT NULL,
valor_carga numeric(15,2) NOT NULL,
tipo_embalagem character varying(100) NOT NULL,
carga_perigosa character varying(3) NOT NULL,
tempo_dias integer(32) NOT NULL,
tempo_horas integer(32) NOT NULL,
tempo_minutos integer(32) NOT NULL,
frequencia character varying(50) NOT NULL,
frequencia_outra character varying(255),
importancia_custo character varying(20) NOT NULL,
variacao_custo numeric(5,2) NOT NULL,
importancia_tempo character varying(20) NOT NULL,
variacao_tempo numeric(5,2) NOT NULL,
importancia_confiabilidade character varying(20) NOT NULL,
variacao_confiabilidade numeric(5,2) NOT NULL,
importancia_seguranca character varying(20) NOT NULL,
variacao_seguranca numeric(5,2) NOT NULL,
importancia_capacidade character varying(20) NOT NULL,
variacao_capacidade numeric(5,2) NOT NULL,
tipo_cadeia character varying(50) NOT NULL,
modais_alternativos ARRAY,
fator_adicional text,
dificuldades ARRAY,
detalhe_dificuldade text,
observacoes text,
capacidade_utilizada numeric(5,2),
num_paradas integer(32),
frequencia_diaria numeric(4,1),
consentimento boolean DEFAULT false,
transporta_carga boolean DEFAULT false,
origem_instalacao character varying(255),
destino_instalacao character varying(255),
volume_anual_toneladas numeric(15,2),
tipo_produto character varying(100),
classe_produto character varying(100),
produtos_especificos text,
modal_predominante character varying(50),
modal_secundario character varying(50),
modal_terciario character varying(50),
proprio_terceirizado character varying(50),
qtd_caminhoes_proprios integer(32),
qtd_caminhoes_terceirizados integer(32),
tempo_transporte character varying(50),
custo_medio_tonelada numeric(15,2),
pedagio_custo numeric(15,2),
frete_custo numeric(15,2),
manutencao_custo numeric(15,2),
outros_custos numeric(15,2),
principais_desafios text,
investimento_sustentavel character varying(10),
reducao_emissoes text,
tecnologias_interesse text,
uso_tecnologia character varying(50),
grau_automacao character varying(50),
rastreamento_carga boolean DEFAULT false,
uso_dados text,
conhecimento_hidrovias character varying(50),
viabilidade_hidrovia character varying(50),
pontos_melhoria text,
interesse_parcerias boolean DEFAULT false,
feedback_formulario text,
id_instalacao_origem integer(32)
,
  PRIMARY KEY (id_pesquisa)
);

-- Constraints:
-- name: check_capacidade_utilizada
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_capacidade_utilizada CHECK (((capacidade_utilizada >= (0)::numeric) AND (capacidade_utilizada <= (100)::numeric)));
-- name: check_carga_perigosa
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_carga_perigosa CHECK (((carga_perigosa)::text = ANY ((ARRAY['sim'::character varying, 'nao'::character varying, 'nao-sei'::character varying])::text[])));
-- name: check_frequencia_diaria
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_frequencia_diaria CHECK ((frequencia_diaria > (0)::numeric));
-- name: check_num_paradas
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_num_paradas CHECK ((num_paradas > 0));
-- name: check_status
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_status CHECK (((status)::text = ANY ((ARRAY['rascunho'::character varying, 'finalizada'::character varying, 'validada'::character varying])::text[])));
-- name: check_tem_paradas
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_tem_paradas CHECK (((tem_paradas)::text = ANY ((ARRAY['sim'::character varying, 'nao'::character varying, 'nao-sei'::character varying])::text[])));
-- name: check_tipo_responsavel
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_tipo_responsavel CHECK (((tipo_responsavel)::text = ANY ((ARRAY['entrevistador'::character varying, 'entrevistado'::character varying])::text[])));
-- name: check_tipo_transporte
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT check_tipo_transporte CHECK (((tipo_transporte)::text = ANY ((ARRAY['importacao'::character varying, 'exportacao'::character varying, 'local'::character varying, 'nao-sei'::character varying])::text[])));
-- name: pesquisas_id_empresa_fkey
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT pesquisas_id_empresa_fkey FOREIGN KEY (id_empresa) REFERENCES formulario_embarcadores.empresas(id_empresa);
-- name: pesquisas_id_entrevistado_fkey
ALTER TABLE formulario_embarcadores.pesquisas ADD CONSTRAINT pesquisas_id_entrevistado_fkey FOREIGN KEY (id_entrevistado) REFERENCES formulario_embarcadores.entrevistados(id_entrevistado);

